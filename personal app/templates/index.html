<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="apple-mobile-web-app-title" content="Galaxy Life"/>
<meta name="theme-color" content="#06001a"/>
<title>Galaxy Life Dashboard</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{background:#06001a;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;color:#f1f5f9;overscroll-behavior:none;min-height:100vh}
:root{--purple:#a855f7;--pink:#ec4899;--blue:#60a5fa;--cyan:#22d3ee;--green:#4ade80;--yellow:#facc15;--red:#f87171;--muted:#94a3b8;--border:rgba(168,85,247,0.22);--card:rgba(168,85,247,0.08);--inp:rgba(255,255,255,0.07)}
@keyframes twk{from{opacity:.2;transform:scale(.8)}to{opacity:.9;transform:scale(1.3)}}
@keyframes fadeIn{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
@keyframes spin{to{transform:rotate(360deg)}}
::-webkit-scrollbar{width:3px}
::-webkit-scrollbar-thumb{background:#a855f744;border-radius:2px}
input[type=date]::-webkit-calendar-picker-indicator,
input[type=datetime-local]::-webkit-calendar-picker-indicator{filter:invert(1)}

/* Stars */
.star{position:fixed;border-radius:50%;background:white;pointer-events:none;z-index:0}
.nebula{position:fixed;border-radius:50%;pointer-events:none;z-index:0}

/* Layout */
#app{position:relative;z-index:1;min-height:100vh}
#auth-screen{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn .5s ease}
#main-screen{display:none;min-height:100vh}

/* Cards */
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;backdrop-filter:blur(12px);margin-bottom:12px}

/* Form elements */
.inp{background:var(--inp);border:1px solid var(--border);border-radius:10px;padding:10px 14px;color:#f1f5f9;outline:none;width:100%;font-size:14px}
.inp::placeholder{color:var(--muted)}
.sel{background:#120028;border:1px solid var(--border);border-radius:10px;padding:10px 12px;color:#f1f5f9;outline:none;font-size:14px}
textarea.inp{resize:vertical;min-height:110px;font-family:inherit}

/* Buttons */
.btn{border:none;border-radius:10px;padding:10px 18px;color:white;font-size:14px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:6px}
.btn-purple{background:linear-gradient(135deg,var(--purple),#7c3aed)}
.btn-green{background:linear-gradient(135deg,var(--green),var(--cyan))}
.btn-red{background:linear-gradient(135deg,var(--red),#dc2626)}
.btn-pink{background:linear-gradient(135deg,var(--pink),var(--purple))}
.btn-block{width:100%;justify-content:center}
.icon-btn{background:none;border:none;cursor:pointer;color:var(--red);padding:4px;display:flex;align-items:center}

/* Progress bar */
.pbar{height:6px;border-radius:3px;background:rgba(255,255,255,.08);overflow:hidden}
.pbar-fill{height:100%;border-radius:3px;transition:width .4s}

/* Header */
#header{position:sticky;top:0;z-index:20;background:rgba(6,0,26,.88);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:10px 16px;display:flex;align-items:center;gap:10}
#header .logo{font-size:24px}
#header .titles{flex:1}
#header .titles h1{font-size:15px;font-weight:800}
#header .titles p{font-size:11px;color:var(--muted)}
#header .user-area{display:flex;align-items:center;gap:8px}
#header .avatar{width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,var(--purple),var(--pink));display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;flex-shrink:0}
#header .username{font-size:13px;font-weight:600;max-width:70px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

/* Bottom nav */
#bottom-nav{position:fixed;bottom:0;left:0;right:0;z-index:20;background:rgba(6,0,26,.94);backdrop-filter:blur(24px);border-top:1px solid var(--border);display:flex;padding-bottom:max(8px,env(safe-area-inset-bottom))}
.nav-btn{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;background:none;border:none;cursor:pointer;padding:6px 2px;color:var(--muted);transition:color .2s;font-family:inherit}
.nav-btn.active{color:var(--purple)}
.nav-btn svg{display:block}
.nav-btn span{font-size:9px;font-weight:400}
.nav-btn.active span{font-weight:700}
.nav-dot{width:20px;height:2px;border-radius:1px;background:linear-gradient(90deg,var(--purple),var(--pink));margin-top:1px;display:none}
.nav-btn.active .nav-dot{display:block}

/* Content */
#content{padding:14px 14px 105px;max-width:500px;margin:0 auto}
.section{display:none;animation:fadeIn .3s ease}
.section.active{display:block}

/* Auth */
.auth-card{width:100%;max-width:380px}
.auth-logo{text-align:center;margin-bottom:28px}
.auth-logo .emoji{font-size:64px;filter:drop-shadow(0 0 24px rgba(168,85,247,.7))}
.auth-logo h1{font-size:24px;font-weight:800;margin-top:6px}
.auth-logo p{color:var(--muted);font-size:13px;margin-top:4px}
.tab-toggle{display:flex;background:rgba(255,255,255,.05);border-radius:12px;padding:3px;margin-bottom:22px}
.tab-toggle button{flex:1;padding:9px 0;border-radius:10px;border:none;cursor:pointer;font-size:13px;font-weight:600;transition:all .2s;color:var(--muted);background:transparent}
.tab-toggle button.active{background:var(--purple);color:white}
.form-group{display:flex;flex-direction:column;gap:12px}
.inp-icon{position:relative}
.inp-icon .icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--muted);pointer-events:none}
.inp-icon input{padding-left:38px}
.inp-icon .eye-btn{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--muted);display:flex}
.error-box{background:rgba(248,113,113,.12);border:1px solid rgba(248,113,113,.3);border-radius:10px;padding:10px 14px;color:var(--red);font-size:13px}
.auth-footer{text-align:center;margin-top:16px;color:var(--muted);font-size:12px}
.auth-footer button{background:none;border:none;color:var(--purple);cursor:pointer;font-size:12px;font-weight:600}
.auth-note{text-align:center;margin-top:14px;color:var(--muted);font-size:11px}

/* Stats row */
.stats-row{display:flex;gap:10px;margin-bottom:12px}
.stat-card{flex:1;text-align:center;padding:12px}
.stat-card .label{color:var(--muted);font-size:11px}
.stat-card .value{font-size:20px;font-weight:700;margin-top:2px}

/* Expense item */
.expense-item{padding:10px 14px;display:flex;align-items:center;gap:10px}
.exp-icon{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--purple),var(--pink));display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;color:white;flex-shrink:0;text-transform:uppercase}
.exp-info{flex:1;min-width:0}
.exp-info .amount{font-weight:600}
.exp-info .meta{color:var(--muted);font-size:11px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

/* Todo */
.todo-filters{display:flex;gap:6px;margin-top:10px}
.filter-btn{flex:1;padding:7px 0;border-radius:8px;border:none;cursor:pointer;font-size:12px;font-weight:600;background:rgba(255,255,255,.05);color:var(--muted)}
.filter-btn.active{background:var(--purple);color:white}
.todo-item{padding:10px 14px;display:flex;align-items:center;gap:10px}
.check-btn{width:24px;height:24px;border-radius:6px;border:2px solid var(--muted);background:none;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .2s}
.check-btn.done{border-color:var(--green);background:var(--green)}
.todo-text{flex:1;font-size:14px}
.todo-text.done{color:var(--muted);text-decoration:line-through}

/* Habit */
.habit-item{padding:10px 14px;display:flex;align-items:center;gap:10px}
.habit-check{width:28px;height:28px;border-radius:8px;border:2px solid var(--muted);background:none;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .2s}
.habit-check.done{border-color:var(--green);background:linear-gradient(135deg,var(--green),var(--cyan))}
.habit-info .name{font-size:14px;font-weight:600}
.habit-info .streak{color:var(--yellow);font-size:11px}

/* Stars rating */
.stars-row{display:flex;justify-content:center;gap:8px;margin-bottom:14px}
.star-btn{background:none;border:none;cursor:pointer;font-size:30px;transition:transform .2s}
.star-btn.active{transform:scale(1.2)}
.star-btn.inactive{filter:grayscale(1) opacity(.35);transform:scale(0.9)}

/* Reminders */
.reminder-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.reminder-item{display:flex;align-items:center;gap:10px;padding:9px 0;border-bottom:1px solid var(--border)}

/* Goal */
.goal-item{margin-bottom:12px}
.goal-header{display:flex;align-items:flex-start;gap:10px;margin-bottom:10px}
.goal-check{width:24px;height:24px;border-radius:6px;border:2px solid var(--muted);background:none;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:2px;transition:all .2s}
.goal-check.done{border-color:var(--green);background:var(--green)}

/* Calendar */
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px}
.cal-day-label{text-align:center;color:var(--muted);font-size:10px;padding-bottom:6px}
.cal-day{aspect-ratio:1;border-radius:8px;border:1px solid transparent;cursor:pointer;background:rgba(255,255,255,.04);color:#f1f5f9;font-size:13px;position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:0;transition:all .2s}
.cal-day:hover{background:rgba(168,85,247,.2)}
.cal-day.today{background:rgba(168,85,247,.3);font-weight:700}
.cal-day.selected{background:var(--purple);border-color:var(--purple)}
.cal-day-dot{position:absolute;bottom:2px;width:5px;height:5px;border-radius:50%}
.cal-nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.cal-nav button{background:none;border:none;cursor:pointer;color:#f1f5f9;padding:4px}
.cal-nav h3{font-weight:700;font-size:15px}

/* Toast */
#toast{position:fixed;top:14px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,var(--purple),var(--pink));color:white;padding:12px 22px;border-radius:14px;z-index:999;font-weight:600;font-size:14px;box-shadow:0 8px 32px rgba(168,85,247,.5);white-space:nowrap;display:none}

/* Loading */
.loader{width:40px;height:40px;border:3px solid rgba(168,85,247,.2);border-top-color:var(--purple);border-radius:50%;animation:spin 1s linear infinite;margin:40px auto}

/* Row flex */
.row{display:flex;gap:8px}
.row .inp,.row .sel{flex:1}
.section-title{font-weight:700;margin-bottom:10px;color:#f1f5f9}
.muted{color:var(--muted)}
.empty{color:var(--muted);text-align:center;padding:24px}
</style>
</head>
<body>

<div id="stars-container"></div>

<div id="toast"></div>

<div id="app">
  <!-- AUTH SCREEN -->
  <div id="auth-screen">
    <div class="auth-card">
      <div class="auth-logo">
        <div class="emoji">üåå</div>
        <h1>Galaxy Dashboard</h1>
        <p>Your personal life companion</p>
      </div>
      <div class="card" style="padding:24px">
        <div class="tab-toggle">
          <button class="active" onclick="switchMode('login')">Sign In</button>
          <button onclick="switchMode('register')">Create Account</button>
        </div>
        <div class="form-group">
          <div class="inp-icon">
            <svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            <input class="inp" id="auth-user" placeholder="Username" onkeydown="if(event.key==='Enter')doAuth()"/>
          </div>
          <div class="inp-icon">
            <svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
            <input class="inp" id="auth-pass" type="password" placeholder="Password" onkeydown="if(event.key==='Enter')doAuth()"/>
            <button class="eye-btn" onclick="togglePass('auth-pass',this)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
            </button>
          </div>
          <div class="inp-icon" id="conf-wrap" style="display:none">
            <svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
            <input class="inp" id="auth-conf" type="password" placeholder="Confirm password" onkeydown="if(event.key==='Enter')doAuth()"/>
          </div>
          <div class="error-box" id="auth-err" style="display:none"></div>
          <button class="btn btn-purple btn-block" style="padding:13px;font-size:15px" onclick="doAuth()">
            <span id="auth-btn-text">üöÄ Sign In</span>
          </button>
        </div>
        <div class="auth-footer">
          <span id="auth-switch-text">Don't have an account? </span>
          <button onclick="switchMode()">Create one</button>
        </div>
      </div>
      <div class="auth-note">üîí Data saved securely on server</div>
    </div>
  </div>

  <!-- MAIN SCREEN -->
  <div id="main-screen">
    <div id="header">
      <div class="logo">üåå</div>
      <div class="titles">
        <h1>Galaxy Dashboard</h1>
        <p id="section-title">üí∏ Expenses</p>
      </div>
      <div class="user-area">
        <div class="avatar" id="user-avatar">?</div>
        <span class="username" id="user-name"></span>
        <button class="icon-btn" style="color:var(--muted)" onclick="doLogout()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        </button>
      </div>
    </div>

    <div id="content">
      <!-- EXPENSES -->
      <div class="section active" id="sec-expense">
        <div class="stats-row">
          <div class="card stat-card"><div class="label">This Month</div><div class="value" id="exp-month" style="color:var(--purple)">‚Çπ0</div></div>
          <div class="card stat-card"><div class="label">All Time</div><div class="value" id="exp-total" style="color:var(--pink)">‚Çπ0</div></div>
        </div>
        <div class="card">
          <div class="form-group">
            <div class="row">
              <input class="inp" id="exp-amount" type="number" placeholder="Amount ‚Çπ"/>
              <select class="sel" id="exp-cat">
                <option>Food</option><option>Transport</option><option>Shopping</option>
                <option>Health</option><option>Entertainment</option><option>Bills</option><option>Other</option>
              </select>
            </div>
            <input class="inp" id="exp-note" placeholder="Note (optional)"/>
            <input class="inp" id="exp-date" type="date"/>
            <button class="btn btn-purple btn-block" onclick="addExpense()">+ Add Expense</button>
          </div>
        </div>
        <div id="expenses-list"></div>
      </div>

      <!-- CHART -->
      <div class="section" id="sec-chart">
        <div class="card">
          <div class="section-title" id="chart-month-label">By Category</div>
          <canvas id="pie-chart" height="220"></canvas>
        </div>
        <div class="card">
          <div class="section-title">Weekly Spending</div>
          <canvas id="bar-chart" height="180"></canvas>
        </div>
      </div>

      <!-- TODOS -->
      <div class="section" id="sec-todo">
        <div class="card">
          <div class="row">
            <input class="inp" id="todo-inp" placeholder="New task..." onkeydown="if(event.key==='Enter')addTodo()"/>
            <button class="btn btn-purple" onclick="addTodo()">+</button>
          </div>
          <div class="todo-filters">
            <button class="filter-btn active" onclick="setFilter('all',this)">All</button>
            <button class="filter-btn" onclick="setFilter('active',this)">Active</button>
            <button class="filter-btn" onclick="setFilter('done',this)">Done</button>
          </div>
        </div>
        <div id="todos-list"></div>
      </div>

      <!-- HABITS -->
      <div class="section" id="sec-habit">
        <div class="card" style="text-align:center">
          <div class="muted" style="font-size:12px">Today's Completion</div>
          <div id="habit-progress-text" style="color:var(--yellow);font-size:26px;font-weight:700;margin:4px 0">0 / 0</div>
          <div class="pbar"><div class="pbar-fill" id="habit-pbar" style="background:linear-gradient(90deg,var(--purple),var(--pink));width:0%"></div></div>
        </div>
        <div class="card">
          <div class="row">
            <input class="inp" id="habit-inp" placeholder="New habit..." onkeydown="if(event.key==='Enter')addHabit()"/>
            <button class="btn btn-purple" onclick="addHabit()">+</button>
          </div>
        </div>
        <div id="habits-list"></div>
      </div>

      <!-- REFLECT -->
      <div class="section" id="sec-reflect">
        <div class="card">
          <div style="font-weight:700;margin-bottom:4px">How was your day?</div>
          <div class="muted" style="font-size:11px;margin-bottom:14px" id="reflect-date"></div>
          <div class="stars-row" id="stars-row"></div>
          <textarea class="inp" id="reflect-note" placeholder="Write about your day, feelings, wins, lessons..."></textarea>
          <button class="btn btn-purple btn-block" style="margin-top:10px" onclick="saveReflection()" id="reflect-btn">Save Reflection</button>
        </div>
        <div id="reflections-list"></div>
      </div>

      <!-- REMINDERS -->
      <div class="section" id="sec-remind">
        <div class="card">
          <div class="form-group">
            <input class="inp" id="rem-title" placeholder="Reminder title..."/>
            <input class="inp" id="rem-dt" type="datetime-local"/>
            <button class="btn btn-purple btn-block" onclick="addReminder()">+ Add Reminder</button>
          </div>
        </div>
        <div id="reminders-list"></div>
      </div>

      <!-- GOALS -->
      <div class="section" id="sec-goal">
        <div class="card">
          <div class="form-group">
            <input class="inp" id="goal-title" placeholder="Goal title..."/>
            <input class="inp" id="goal-target" type="date"/>
            <div class="muted" style="font-size:12px">Starting progress: <span id="goal-prog-label">0</span>%</div>
            <input type="range" min="0" max="100" value="0" id="goal-prog" style="width:100%;accent-color:var(--purple)" oninput="document.getElementById('goal-prog-label').textContent=this.value"/>
            <button class="btn btn-purple btn-block" onclick="addGoal()">+ Add Goal</button>
          </div>
        </div>
        <div id="goals-list"></div>
      </div>

      <!-- CALENDAR -->
      <div class="section" id="sec-calendar">
        <div class="card">
          <div class="cal-nav">
            <button onclick="changeMonth(-1)">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
            </button>
            <h3 id="cal-title"></h3>
            <button onclick="changeMonth(1)">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
            </button>
          </div>
          <div class="cal-grid" id="cal-grid"></div>
        </div>
        <div class="card" id="cal-detail" style="display:none">
          <div style="font-weight:700;margin-bottom:10px" id="cal-detail-title">üìÖ</div>
          <div class="form-group">
            <input class="inp" id="cal-occasion" placeholder="Special occasion (Birthday, Anniversary...)"/>
            <textarea class="inp" id="cal-note" placeholder="Add a note for this day..." style="min-height:90px;resize:none"></textarea>
            <div class="row">
              <button class="btn btn-purple" style="flex:1;justify-content:center" onclick="saveCalEvent()">üíæ Save</button>
              <button class="btn btn-red" id="cal-del-btn" style="display:none" onclick="delCalEvent()">üóë</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- BOTTOM NAV -->
    <nav id="bottom-nav">
      <button class="nav-btn active" onclick="goto('expense',this,'üí∏ Expenses')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>
        <span>Expenses</span><div class="nav-dot"></div>
      </button>
      <button class="nav-btn" onclick="goto('chart',this,'üìä Spending')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
        <span>Chart</span><div class="nav-dot"></div>
      </button>
      <button class="nav-btn" onclick="goto('todo',this,'‚úÖ Tasks')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg>
        <span>Tasks</span><div class="nav-dot"></div>
      </button>
      <button class="nav-btn" onclick="goto('habit',this,'üî• Habits')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8.5 14.5A2.5 2.5 0 0011 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 11-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 002.5 2.5z"/></svg>
        <span>Habits</span><div class="nav-dot"></div>
      </button>
      <button class="nav-btn" onclick="goto('reflect',this,'üìñ Reflect')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg>
        <span>Reflect</span><div class="nav-dot"></div>
      </button>
      <button class="nav-btn" onclick="goto('remind',this,'‚è∞ Reminders')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
        <span>Remind</span><div class="nav-dot"></div>
      </button>
      <button class="nav-btn" onclick="goto('goal',this,'üéØ Goals')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
        <span>Goals</span><div class="nav-dot"></div>
      </button>
      <button class="nav-btn" onclick="goto('calendar',this,'üìÖ Calendar')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        <span>Calendar</span><div class="nav-dot"></div>
      </button>
    </nav>
  </div>
</div>

<script>
// ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const uid=()=>Date.now().toString(36)+Math.random().toString(36).slice(2);
const today=()=>new Date().toISOString().slice(0,10);
const $=id=>document.getElementById(id);
const API=async(url,method="GET",body)=>{
  const opts={method,credentials:"include",headers:{"Content-Type":"application/json"}};
  if(body)opts.body=JSON.stringify(body);
  const r=await fetch(url,opts);
  return r.json();
};
const showToast=msg=>{const t=$("toast");t.textContent=msg;t.style.display="block";setTimeout(()=>t.style.display="none",4000);};

// ‚îÄ‚îÄ Stars ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(()=>{
  const c=$("stars-container");
  for(let i=0;i<80;i++){
    const s=document.createElement("div");
    const sz=Math.random()*2+.4;
    s.className="star";
    s.style.cssText=`left:${Math.random()*100}%;top:${Math.random()*100}%;width:${sz}px;height:${sz}px;animation:twk ${Math.random()*3+1.5}s ease-in-out infinite alternate`;
    c.appendChild(s);
  }
  // Nebula glows
  [["top:-120px;right:-100px","rgba(168,85,247,.18)"],["bottom:80px;left:-100px","rgba(236,72,153,.14)"]].forEach(([pos,color])=>{
    const n=document.createElement("div");
    n.className="nebula";
    n.style.cssText=`${pos};width:300px;height:300px;background:radial-gradient(circle,${color},transparent 70%)`;
    c.appendChild(n);
  });
})();

// ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let state={expenses:[],todos:[],habits:[],habitLogs:[],reflections:[],reminders:[],goals:[],calEvents:[],rating:0};
let todoFilter="all";
let calDate=new Date();
let selCalDay=null;
let pieChart=null,barChart=null;

// ‚îÄ‚îÄ Auth ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let authMode="login";
function switchMode(m){
  if(m)authMode=m;else authMode=authMode==="login"?"register":"login";
  document.querySelectorAll(".tab-toggle button").forEach((b,i)=>{
    b.classList.toggle("active",(authMode==="login"&&i===0)||(authMode==="register"&&i===1));
  });
  $("conf-wrap").style.display=authMode==="register"?"block":"none";
  $("auth-btn-text").textContent=authMode==="login"?"üöÄ Sign In":"‚ú® Create Account";
  $("auth-switch-text").textContent=authMode==="login"?"Don't have an account? ":"Have an account? ";
  document.querySelector(".auth-footer button").textContent=authMode==="login"?"Create one":"Sign in";
  $("auth-err").style.display="none";
}

async function doAuth(){
  const u=$("auth-user").value.trim();
  const p=$("auth-pass").value;
  const c=$("auth-conf").value;
  $("auth-err").style.display="none";
  if(authMode==="register"){
    if(u.length<3)return showErr("Username must be 3+ characters.");
    if(p.length<4)return showErr("Password must be 4+ characters.");
    if(p!==c)return showErr("Passwords don't match.");
    const r=await API("/api/register","POST",{username:u,password:p,displayName:u});
    if(r.error)return showErr(r.error);
    enterApp(r.displayName);
  } else {
    const r=await API("/api/login","POST",{username:u,password:p});
    if(r.error)return showErr(r.error);
    enterApp(r.displayName);
  }
}

function showErr(msg){const e=$("auth-err");e.textContent=msg;e.style.display="block";}

function togglePass(id,btn){
  const inp=$(id);
  inp.type=inp.type==="password"?"text":"password";
}

async function doLogout(){
  await API("/api/logout","POST");
  $("main-screen").style.display="none";
  $("auth-screen").style.display="flex";
}

async function enterApp(dn){
  $("auth-screen").style.display="none";
  $("main-screen").style.display="block";
  $("user-name").textContent=dn;
  $("user-avatar").textContent=dn[0].toUpperCase();
  $("reflect-date").textContent=today();
  await loadAll();
  initStars();
  startReminderCheck();
}

// ‚îÄ‚îÄ Load All ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadAll(){
  const [exp,todos,habits,hlog,refs,rems,goals,cal]=await Promise.all([
    API("/api/expenses"),API("/api/todos"),API("/api/habits"),
    API("/api/habit-logs"),API("/api/reflections"),API("/api/reminders"),
    API("/api/goals"),API("/api/calendar")
  ]);
  state.expenses=exp; state.todos=todos; state.habits=habits;
  state.habitLogs=hlog; state.reflections=refs; state.reminders=rems;
  state.goals=goals; state.calEvents=cal;
  renderAll();
}

function renderAll(){
  renderExpenses(); renderTodos(); renderHabits();
  renderReflections(); renderReminders(); renderGoals();
  renderCalendar(); renderCharts();
}

// ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function goto(sec,btn,title){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.querySelectorAll(".nav-btn").forEach(b=>b.classList.remove("active"));
  $("sec-"+sec).classList.add("active");
  btn.classList.add("active");
  $("section-title").textContent=title;
  if(sec==="chart")renderCharts();
}

// ‚îÄ‚îÄ Expenses ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function addExpense(){
  const a=$("exp-amount").value;
  if(!a)return;
  const exp={id:uid(),amount:parseFloat(a),category:$("exp-cat").value,note:$("exp-note").value,date:$("exp-date").value||today()};
  await API("/api/expenses","POST",exp);
  $("exp-amount").value="";$("exp-note").value="";
  state.expenses.unshift(exp);
  renderExpenses();renderCharts();
}

async function delExpense(id){
  await API("/api/expenses/"+id,"DELETE");
  state.expenses=state.expenses.filter(e=>e.id!==id);
  renderExpenses();renderCharts();
}

function renderExpenses(){
  const mo=today().slice(0,7);
  const moT=state.expenses.filter(e=>e.date.slice(0,7)===mo).reduce((s,e)=>s+e.amount,0);
  const tot=state.expenses.reduce((s,e)=>s+e.amount,0);
  $("exp-month").textContent="‚Çπ"+moT.toFixed(0);
  $("exp-total").textContent="‚Çπ"+tot.toFixed(0);
  const el=$("expenses-list");
  if(!state.expenses.length){el.innerHTML='<div class="empty">No expenses yet ‚ú®</div>';return;}
  el.innerHTML=state.expenses.slice(0,25).map(e=>`
    <div class="card expense-item">
      <div class="exp-icon">${e.category.slice(0,3)}</div>
      <div class="exp-info">
        <div class="amount">‚Çπ${parseFloat(e.amount).toFixed(2)}</div>
        <div class="meta">${e.category}${e.note?" ¬∑ "+e.note:""} ¬∑ ${e.date}</div>
      </div>
      <button class="icon-btn" onclick="delExpense('${e.id}')">üóë</button>
    </div>`).join("");
}

// ‚îÄ‚îÄ Charts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderCharts(){
  const mo=today().slice(0,7);
  const moE=state.expenses.filter(e=>e.date&&e.date.slice(0,7)===mo);
  $("chart-month-label").textContent=`By Category ‚Äî ${mo}`;
  const cm={};moE.forEach(e=>{cm[e.category]=(cm[e.category]||0)+e.amount;});
  const colors=["#a855f7","#ec4899","#60a5fa","#22d3ee","#4ade80","#facc15","#f97316"];
  const pieCtx=document.getElementById("pie-chart");
  if(pieChart)pieChart.destroy();
  pieChart=new Chart(pieCtx,{type:"pie",data:{labels:Object.keys(cm),datasets:[{data:Object.values(cm),backgroundColor:colors}]},options:{plugins:{legend:{labels:{color:"#94a3b8",font:{size:11}}}},animation:{duration:600}}});
  const wm={};moE.forEach(e=>{if(!e.date)return;const w=`W${Math.ceil(new Date(e.date).getDate()/7)}`;wm[w]=(wm[w]||0)+e.amount;});
  const barCtx=document.getElementById("bar-chart");
  if(barChart)barChart.destroy();
  barChart=new Chart(barCtx,{type:"bar",data:{labels:Object.keys(wm),datasets:[{data:Object.values(wm),backgroundColor:"#a855f7",borderRadius:6}]},options:{plugins:{legend:{display:false}},scales:{x:{ticks:{color:"#94a3b8"}},y:{ticks:{color:"#94a3b8"},grid:{color:"rgba(255,255,255,.05)"}}},animation:{duration:600}}});
}

// ‚îÄ‚îÄ Todos ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function addTodo(){
  const t=$("todo-inp").value.trim();
  if(!t)return;
  const todo={id:uid(),text:t,done:0};
  await API("/api/todos","POST",todo);
  $("todo-inp").value="";
  state.todos.unshift(todo);
  renderTodos();
}

async function toggleTodo(id,done){
  await API("/api/todos/"+id,"PUT",{done:done?0:1});
  state.todos=state.todos.map(t=>t.id===id?{...t,done:done?0:1}:t);
  renderTodos();
}

async function delTodo(id){
  await API("/api/todos/"+id,"DELETE");
  state.todos=state.todos.filter(t=>t.id!==id);
  renderTodos();
}

function setFilter(f,btn){
  todoFilter=f;
  document.querySelectorAll(".filter-btn").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  renderTodos();
}

function renderTodos(){
  const list=state.todos.filter(t=>todoFilter==="all"?true:todoFilter==="active"?!t.done:t.done);
  const el=$("todos-list");
  if(!list.length){el.innerHTML='<div class="empty">Nothing here ‚ú®</div>';return;}
  el.innerHTML=list.map(t=>`
    <div class="card todo-item">
      <button class="check-btn ${t.done?"done":""}" onclick="toggleTodo('${t.id}',${t.done})">
        ${t.done?'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><polyline points="20 6 9 20 4 15"/></svg>':""}
      </button>
      <span class="todo-text ${t.done?"done":""}">${t.text}</span>
      <button class="icon-btn" onclick="delTodo('${t.id}')">üóë</button>
    </div>`).join("");
}

// ‚îÄ‚îÄ Habits ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function addHabit(){
  const n=$("habit-inp").value.trim();
  if(!n)return;
  const h={id:uid(),name:n};
  await API("/api/habits","POST",h);
  $("habit-inp").value="";
  state.habits.push(h);
  renderHabits();
}

async function toggleHabit(id,checked){
  await API("/api/habit-logs","POST",{habitId:id,date:today(),checked});
  if(checked){state.habitLogs=state.habitLogs.filter(l=>!(l.habit_id===id&&l.date===today()));}
  else{state.habitLogs.push({habit_id:id,date:today()});}
  renderHabits();
}

async function delHabit(id){
  await API("/api/habits/"+id,"DELETE");
  state.habits=state.habits.filter(h=>h.id!==id);
  renderHabits();
}

function getStreak(id){
  let s=0,dt=new Date();
  while(true){
    const k=dt.toISOString().slice(0,10);
    if(state.habitLogs.some(l=>l.habit_id===id&&l.date===k)){s++;dt.setDate(dt.getDate()-1);}
    else break;
  }
  return s;
}

function renderHabits(){
  const td=today();
  const loggedToday=id=>state.habitLogs.some(l=>l.habit_id===id&&l.date===td);
  const done=state.habits.filter(h=>loggedToday(h.id)).length;
  $("habit-progress-text").textContent=`${done} / ${state.habits.length}`;
  $("habit-pbar").style.width=(state.habits.length?done/state.habits.length*100:0)+"%";
  const el=$("habits-list");
  if(!state.habits.length){el.innerHTML='<div class="empty">Add your first habit! üí´</div>';return;}
  el.innerHTML=state.habits.map(h=>{
    const ok=loggedToday(h.id);const s=getStreak(h.id);
    return `<div class="card habit-item">
      <button class="habit-check ${ok?"done":""}" onclick="toggleHabit('${h.id}',${ok})">
        ${ok?'<svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><polyline points="20 6 9 20 4 15"/></svg>':""}
      </button>
      <div class="habit-info" style="flex:1">
        <div class="name" style="${ok?"text-decoration:line-through;color:var(--muted)":""}">${h.name}</div>
        ${s>0?`<div class="streak">üî• ${s} day streak</div>`:""}
      </div>
      <button class="icon-btn" onclick="delHabit('${h.id}')">üóë</button>
    </div>`;
  }).join("");
}

// ‚îÄ‚îÄ Reflections ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initStars(){
  const row=$("stars-row");
  row.innerHTML=[1,2,3,4,5].map(n=>`<button class="star-btn inactive" data-n="${n}" onclick="setRating(${n})">‚≠ê</button>`).join("");
  const td=today();
  const ex=state.reflections.find(r=>r.date===td);
  if(ex){state.rating=ex.rating;$("reflect-note").value=ex.note||"";}
  updateStars();
}

function setRating(n){state.rating=n;updateStars();}
function updateStars(){
  document.querySelectorAll(".star-btn").forEach(b=>{
    const n=+b.dataset.n;
    b.className="star-btn "+(n<=state.rating?"active":"inactive");
  });
}

async function saveReflection(){
  const d={date:today(),rating:state.rating,note:$("reflect-note").value};
  await API("/api/reflections","POST",d);
  state.reflections=state.reflections.filter(r=>r.date!==d.date);
  state.reflections.unshift(d);
  const btn=$("reflect-btn");
  btn.textContent="‚úÖ Saved!";btn.className="btn btn-green btn-block";
  setTimeout(()=>{btn.textContent="Save Reflection";btn.className="btn btn-purple btn-block";},2000);
  renderReflections();
}

function renderReflections(){
  const td=today();
  const past=state.reflections.filter(r=>r.date!==td).slice(0,7);
  const el=$("reflections-list");
  if(!past.length){el.innerHTML="";return;}
  el.innerHTML=`<div class="card"><div class="section-title">Past Reflections</div>`+past.map(r=>`
    <div style="padding:10px 0;border-bottom:1px solid var(--border)">
      <div style="display:flex;justify-content:space-between;margin-bottom:4px">
        <span class="muted" style="font-size:12px">${r.date}</span>
        <span>${"‚≠ê".repeat(r.rating)}</span>
      </div>
      ${r.note?`<div style="font-size:13px">${r.note}</div>`:""}
    </div>`).join("")+"</div>";
}

// ‚îÄ‚îÄ Reminders ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function addReminder(){
  const t=$("rem-title").value.trim();
  const dt=$("rem-dt").value;
  if(!t||!dt)return;
  const r={id:uid(),title:t,datetime:dt};
  await API("/api/reminders","POST",r);
  $("rem-title").value="";$("rem-dt").value="";
  state.reminders.push({...r,fired:0});
  renderReminders();
}

async function delReminder(id){
  await API("/api/reminders/"+id,"DELETE");
  state.reminders=state.reminders.filter(r=>r.id!==id);
  renderReminders();
}

function renderReminders(){
  const now=new Date();
  const up=state.reminders.filter(r=>new Date(r.datetime)>=now).sort((a,b)=>new Date(a.datetime)-new Date(b.datetime));
  const past=state.reminders.filter(r=>new Date(r.datetime)<now);
  const el=$("reminders-list");
  if(!state.reminders.length){el.innerHTML='<div class="empty">No reminders yet ‚è∞</div>';return;}
  const row=(r,dim)=>`<div class="reminder-item" style="${dim?"opacity:.5":""}">
    <div class="reminder-dot" style="background:${dim?"var(--muted)":"var(--cyan)"};${dim?"":"box-shadow:0 0 8px var(--cyan)"}"></div>
    <div style="flex:1"><div style="font-weight:600">${r.title}</div><div class="muted" style="font-size:11px">${new Date(r.datetime).toLocaleString()}</div></div>
    <button class="icon-btn" onclick="delReminder('${r.id}')">üóë</button>
  </div>`;
  el.innerHTML=(up.length?`<div class="card"><div class="section-title">Upcoming</div>${up.map(r=>row(r,false)).join("")}</div>`:"")+
    (past.length?`<div class="card"><div class="section-title muted">Past</div>${past.map(r=>row(r,true)).join("")}</div>`:"");
}

function startReminderCheck(){
  setInterval(()=>{
    const now=new Date();
    state.reminders.forEach(r=>{
      if(!r.fired&&Math.abs(now-new Date(r.datetime))<65000){
        showToast("‚è∞ "+r.title);
        r.fired=1;
      }
    });
  },30000);
}

// ‚îÄ‚îÄ Goals ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function addGoal(){
  const t=$("goal-title").value.trim();
  if(!t)return;
  const g={id:uid(),title:t,target:$("goal-target").value,progress:+$("goal-prog").value,done:0};
  await API("/api/goals","POST",g);
  $("goal-title").value="";$("goal-target").value="";$("goal-prog").value=0;$("goal-prog-label").textContent=0;
  state.goals.push(g);
  renderGoals();
}

async function delGoal(id){
  await API("/api/goals/"+id,"DELETE");
  state.goals=state.goals.filter(g=>g.id!==id);
  renderGoals();
}

async function toggleGoal(id,done){
  await API("/api/goals/"+id,"PUT",{done:done?0:1});
  state.goals=state.goals.map(g=>g.id===id?{...g,done:done?0:1}:g);
  renderGoals();
}

async function updateGoalProgress(id,v){
  await API("/api/goals/"+id,"PUT",{progress:+v});
  state.goals=state.goals.map(g=>g.id===id?{...g,progress:+v}:g);
}

function renderGoals(){
  const el=$("goals-list");
  if(!state.goals.length){el.innerHTML='<div class="empty">Set your first goal! üöÄ</div>';return;}
  el.innerHTML=state.goals.map(g=>`
    <div class="card goal-item" style="${g.done?"opacity:.65":""}">
      <div class="goal-header">
        <button class="goal-check ${g.done?"done":""}" onclick="toggleGoal('${g.id}',${g.done})">
          ${g.done?'<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><polyline points="20 6 9 20 4 15"/></svg>':""}
        </button>
        <div style="flex:1">
          <div style="font-weight:700;${g.done?"text-decoration:line-through":""}">${g.title}</div>
          ${g.target_date?`<div class="muted" style="font-size:11px">üéØ Target: ${g.target_date}</div>`:""}
        </div>
        <button class="icon-btn" onclick="delGoal('${g.id}')">üóë</button>
      </div>
      <div style="display:flex;align-items:center;gap:10px">
        <div class="pbar" style="flex:1"><div class="pbar-fill" style="background:linear-gradient(90deg,var(--blue),var(--cyan));width:${g.progress}%"></div></div>
        <span style="color:var(--cyan);font-size:13px;font-weight:700;min-width:38px;text-align:right">${g.progress}%</span>
      </div>
      ${!g.done?`<input type="range" min="0" max="100" value="${g.progress}" style="width:100%;accent-color:var(--blue);margin-top:8px" 
        oninput="updateGoalProgress('${g.id}',this.value);this.previousElementSibling.querySelector('.pbar-fill').style.width=this.value+'%';this.previousElementSibling.querySelector('span').textContent=this.value+'%'"/>`:""}
    </div>`).join("");
}

// ‚îÄ‚îÄ Calendar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const MN=["January","February","March","April","May","June","July","August","September","October","November","December"];

function changeMonth(d){calDate=new Date(calDate.getFullYear(),calDate.getMonth()+d,1);renderCalendar();}

function renderCalendar(){
  const yr=calDate.getFullYear(),mo=calDate.getMonth();
  $("cal-title").textContent=`${MN[mo]} ${yr}`;
  const fd=new Date(yr,mo,1).getDay(),dim=new Date(yr,mo+1,0).getDate();
  const mkDate=d=>`${yr}-${String(mo+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
  const td=today();
  let html=["S","M","T","W","T","F","S"].map(d=>`<div class="cal-day-label">${d}</div>`).join("");
  html+=Array(fd).fill('<div></div>').join("");
  for(let d=1;d<=dim;d++){
    const k=mkDate(d);
    const ev=state.calEvents.find(e=>e.date===k);
    const cls=["cal-day",k===td?"today":"",k===selCalDay?"selected":""].filter(Boolean).join(" ");
    html+=`<button class="${cls}" onclick="pickCalDay('${k}')">
      ${d}${ev?`<div class="cal-day-dot" style="background:${ev.occasion?"var(--pink)":"var(--cyan)"}"></div>`:""}
    </button>`;
  }
  $("cal-grid").innerHTML=html;
}

function pickCalDay(k){
  selCalDay=k;
  renderCalendar();
  const ev=state.calEvents.find(e=>e.date===k)||{note:"",occasion:""};
  $("cal-detail-title").textContent=`üìÖ ${k}`;
  $("cal-occasion").value=ev.occasion||"";
  $("cal-note").value=ev.note||"";
  $("cal-detail").style.display="block";
  $("cal-del-btn").style.display=ev.note||ev.occasion?"inline-flex":"none";
}

async function saveCalEvent(){
  if(!selCalDay)return;
  const d={date:selCalDay,note:$("cal-note").value,occasion:$("cal-occasion").value};
  await API("/api/calendar","POST",d);
  state.calEvents=state.calEvents.filter(e=>e.date!==selCalDay);
  state.calEvents.push(d);
  renderCalendar();
  $("cal-del-btn").style.display="inline-flex";
  showToast("üìÖ Saved!");
}

async function delCalEvent(){
  if(!selCalDay)return;
  await API("/api/calendar/"+selCalDay,"DELETE");
  state.calEvents=state.calEvents.filter(e=>e.date!==selCalDay);
  selCalDay=null;
  $("cal-detail").style.display="none";
  renderCalendar();
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(async()=>{
  const r=await API("/api/me");
  if(r.loggedIn){enterApp(r.displayName);}
  $("exp-date").value=today();
})();
</script>
</body>
</html>
